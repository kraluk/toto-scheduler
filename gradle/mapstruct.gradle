apply plugin: "net.ltgt.apt"
apply plugin: "idea"
apply plugin: "java"

dependencies {
    apt "org.mapstruct:mapstruct-processor:${mapstruct_version}"
    apt "org.hibernate:hibernate-jpamodelgen:${hibernate_version}"
}

// Hack to force IDEA to include generated sources to the project
// https://youtrack.jetbrains.com/issue/IDEA-124090
def generatedSources = "$buildDir/generated"
def generatedOutputDir = file("$generatedSources")

compileJava {
    doFirst {
        generatedOutputDir.exists() || generatedOutputDir.mkdirs()
        options.compilerArgs = [
            '-s', "${generatedSources}"
        ]
    }
}

idea {
    module {
        downloadSources = true
        // tell intellij where to find generated sources
        sourceDirs += generatedOutputDir
    }
}
